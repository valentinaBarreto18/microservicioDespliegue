# Configuraci√≥n de Render para Sistema de Biblioteca
# Este archivo define toda la infraestructura necesaria

databases:
  # Base de datos compartida para todos los servicios
  - name: biblioteca-db
    databaseName: biblioteca_db
    user: biblioteca_user
    plan: free
    region: oregon
    postgresMajorVersion: 15

services:
  # Inventory Service
  - type: web
    name: biblioteca-inventory-service
    runtime: docker
    plan: free
    region: oregon
    dockerfilePath: ./inventory-service/Dockerfile
    dockerContext: .
    envVars:
      - key: SERVER_PORT
        value: 8081
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: DATABASE_HOST
        fromDatabase:
          name: biblioteca-db
          property: host
      - key: DATABASE_PORT
        fromDatabase:
          name: biblioteca-db
          property: port
      - key: DATABASE_NAME
        fromDatabase:
          name: biblioteca-db
          property: database
      - key: SPRING_R2DBC_USERNAME
        fromDatabase:
          name: biblioteca-db
          property: user
      - key: SPRING_R2DBC_PASSWORD
        fromDatabase:
          name: biblioteca-db
          property: password
    healthCheckPath: /actuator/health

  # Loan Service
  - type: web
    name: biblioteca-loan-service
    runtime: docker
    plan: free
    region: oregon
    dockerfilePath: ./loan-service/Dockerfile
    dockerContext: .
    envVars:
      - key: SERVER_PORT
        value: 8082
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: DATABASE_HOST
        fromDatabase:
          name: biblioteca-db
          property: host
      - key: DATABASE_PORT
        fromDatabase:
          name: biblioteca-db
          property: port
      - key: DATABASE_NAME
        fromDatabase:
          name: biblioteca-db
          property: database
      - key: SPRING_R2DBC_USERNAME
        fromDatabase:
          name: biblioteca-db
          property: user
      - key: SPRING_R2DBC_PASSWORD
        fromDatabase:
          name: biblioteca-db
          property: password
      - key: INVENTORY_SERVICE_URL
        fromService:
          type: web
          name: biblioteca-inventory-service
          property: host
    healthCheckPath: /actuator/health

  # API Gateway
  - type: web
    name: biblioteca-api-gateway
    runtime: docker
    plan: free
    region: oregon
    dockerfilePath: ./api-gateway/Dockerfile
    dockerContext: .
    envVars:
      - key: SERVER_PORT
        value: 8080
      - key: INVENTORY_SERVICE_URL
        fromService:
          type: web
          name: biblioteca-inventory-service
          property: host
      - key: LOAN_SERVICE_URL
        fromService:
          type: web
          name: biblioteca-loan-service
          property: host
    healthCheckPath: /actuator/health

